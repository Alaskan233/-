<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°é’Ÿè¯¾å ‚</title>
    <link rel="Shortcut Icon" href="128.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="css/banner.css">
    <link rel="stylesheet" type="text/css" href="css/bar.css">
    <link rel="stylesheet" type="text/css" href="css/videoList.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
</head>
<body>
    <div id="page">
        <div id="loginBar">
            <div id="cover"></div>
            <div id="bar">
                <div class="barItem">é¦–é¡µ</div>
                <div class="barItem">è¯¾ç¨‹ä¸­å¿ƒ</div>
                <div class="barItem">è¶…çº§ä¼šå‘˜</div>
                <div class="barItem">è‡ªå­¦è·¯çº¿</div>
                <div class="barItem">ä¸€å¯¹ä¸€è¾…å¯¼</div>
                <div class="barItem" id="openBtn" v-if="!isLogin" @click="open">ç™»å½•</div>
                <div class="barItem" id="registerBtn" v-if="!isLogin">æ³¨å†Œ</div>
                <div id="userMenu">
                    <div id="userBox" >
                        <img class="barItem" id="head" v-if="isLogin" :src="head" alt="">
                        <div class="barItem" id="name" v-if="isLogin">{{name}}</div>                            
                    </div>
                    <div id="menu">
                        <div class="menuItem">ä¸ªäººä¸­å¿ƒ</div>
                        <div class="menuItem" @click="logout">é€€å‡ºç™»å½•</div>
                    </div>
                </div>
            </div>
            <div id="box">
                <div class="content" @keyup.enter="login">
                    <div id="closeBtn" @click="close">Ã—</div>
                    <div id="input">
                        <input class="inputArea" id="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" type="text"></input>
                        <input class="inputArea" id="password" placeholder="è¯·è¾“å…¥å¯†ç " type="password"></input>
                    </div>
                    <button id="loginBtn" type="submit" @click="login">ç™»å½•</button>
                </div>
            </div>
        </div>
        <div id="banner" @click="getBanner">
            <a :href="showUrl"> 
                <img id="picture" :src="showPic" alt="" />   
            </a>
            <img class="left" v-show='showLeft' @click="prevHandler" :src="left" alt="" />
            <img class="right" v-show='showRight' @click="nextHandler" :src="right" alt="" />
        </div>
        <div id="videoListTitle">ğŸ”¥ çƒ­é—¨è¯¾ç¨‹</div>
        <div id="videoList">
            <div class="video" v-for="(item,i) in videoList" @click="toDetail(item.id)">
                <div>
                    <img class="coverImg" :src="item.cover_img" alt="" />
                    <div class="title">{{item.title}}</div>
                </div>
                <div class="point_price">
                    <div class="point">{{item.point}}</div>
                    <div class="price">ï¿¥{{item.price}}</div>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    var login = new Vue({
        //æŒ‚è½½ç‚¹
        el: '#page',
        //æ•°æ®
        data: {
            showPic: '',                //å±•ç¤ºå›¾ç‰‡
            showUrl: '',                //å±•ç¤ºé“¾æ¥
            pic: [],                    //å›¾ç‰‡åˆ—è¡¨
            showLeft: true,             //å·¦ç®­å¤´
            showRight: true,            //å³ç®­å¤´
            right: 'img/right.png',     //å·¦ç®­å¤´å›¾ç‰‡
            left: 'img/left.png',       //å³ç®­å¤´å›¾ç‰‡
            begin: 0,                   //å›¾ç‰‡èµ·å§‹ç¼–å·
            end: 0,                     //å›¾ç‰‡æœ€ç»ˆç¼–å·
            idx: 0,                     //å›¾ç‰‡å½“å‰ç¼–å·

            isLogin: false,             //æ˜¯å¦ç™»å½•
            head: '',                   //å¤´åƒ
            name: '',                   //ç”¨æˆ·å

            videoList: []               //è§†é¢‘åˆ—è¡¨
        },
        mounted(){
            this.tokenLogin();
            this.getBanner();
            this.autoBanner();
            this.getVideoList();
        },
        //æ–¹æ³•
        methods: {
            // è·å–è½®æ’­å›¾
            getBanner: function() {
                var that = this
                $.ajax({
                    type:"POST",
                    url:"http://127.0.0.1:9000/banner/",
                    contentType: false,
                    processData: false,
                    success:function(res){
                        that.pic = res.data
                        that.showPic = that.pic[that.idx].img
                        that.showUrl = that.pic[that.idx].url
                        that.end = that.pic.length-1
                    }
                })
            },
            // è®¾ç½®å®šæ—¶å™¨
            autoBanner: function() {
                var that = this
                let timer = setInterval(() => {
                if (that.idx < that.end) {
                    that.idx++
                    that.showLeft = true;
                    that.showRight = that.idx !== that.end        
                } else {
                    that.idx = 0
                    that.showLeft = that.idx !== that.begin
                    that.showRight = true
                }
                that.showPic = that.pic[that.idx].img
                that.showUrl = that.pic[that.idx].url
                }, 4000)
            },
            // ç‚¹å‡»å·¦ç®­å¤´
            prevHandler: function () {
                if (this.idx > this.begin) {
                    this.idx--
                }
                this.showLeft = this.idx !== this.begin
                this.showRight = true
                this.showPic = this.pic[this.idx].img
                this.showUrl = this.pic[this.idx].url
            },
            // ç‚¹å‡»å³ç®­å¤´
            nextHandler: function () {
                if (this.idx < this.end) {
                    this.idx++
                }
                this.showLeft = true;
                this.showRight = this.idx !== this.end
                this.showPic = this.pic[this.idx].img
                this.showUrl = this.pic[this.idx].url
            },
            // è·å–è§†é¢‘åˆ—è¡¨
            getVideoList: function() {
                var that = this
                $.ajax({
                    type:"POST",
                    url:"http://127.0.0.1:9000/video/list/",
                    contentType: false,
                    processData: false,
                    success:function(res){
                        that.videoList = res.data
                    }
                })
            },
            // ç‚¹å‡»æ‰“å¼€æŒ‰é’®éšè—æ¨¡æ€æ¡†
            open: function () {
                document.getElementById('box').style.display = "block"
                document.getElementById('cover').style.display = "block"
            },
            // ç‚¹å‡»å…³é—­æŒ‰é’®éšè—æ¨¡æ€æ¡†
            close: function () {
                document.getElementById('box').style.display = "none"
                document.getElementById('cover').style.display = "none"
            },
            // ç™»å½•
            login: function(){
                var that = this
                if($('#phone').val().length == 0){
                    alert("è¯·è¾“å…¥è´¦å·")
                } else if ($('#password').val().length == 0){
                    alert("è¯·è¾“å…¥å¯†ç ")
                } else {
                    var inputData = {phone:$('#phone').val(),password:$('#password').val()}
                    $.ajax({
                        type:"POST",
                        url:"http://127.0.0.1:9000/user/login/",
                        contentType: false,
                        processData: false,
                        data: JSON.stringify(inputData),
                        success:function(res){
                            alert(res.message)
                            that.close()
                            that.isLogin = true
                            that.head = res.data.head
                            that.name = res.data.name
                            $.cookie("token", res.data.token)
                        }
                    })
                }
            },
            // tokenç™»å½•
            tokenLogin: function(){
                var that = this
                var inputData = {token:$.cookie("token")}
                $.ajax({
                    type:"POST",
                    url:"http://127.0.0.1:9000/user/token/",
                    contentType: false,
                    processData: false,
                    data: JSON.stringify(inputData),
                    success:function(res){
                        if(res.code==200){
                            that.isLogin = true
                            that.head = res.data.head
                            that.name = res.data.name
                            $.cookie("token", res.data.token)
                        }
                    }
                })
            },
            // é€€å‡ºç™»å½•
            logout: function(){
                this.isLogin = false
                $.removeCookie('token');
            },
            // è·³è½¬åˆ°è¯¦æƒ…é¡µ
            toDetail: function (videoId){
                location.assign("detail.html?videoId="+videoId);
            }
        }
    })
</script>
</html>